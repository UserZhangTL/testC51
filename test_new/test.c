#include <reg52.h>
#include "delay.h"
#include "uart.h"
#include "tmp_hum_new.h"
#include "key.h"
#include <stdio.h>
#include <string.h>

sbit avoid = P2^0;

extern int temp_value, humi_value;

void Iner0_Init()
{
	  EA = 1; //总中断
	  EX0 = 1;//允许外部中断0
	  IT0 = 1;//设置为下降沿触发，避障模块的避障功能
}

void Iner1_Init()
{
	  EA = 1; //总中断
	  EX1 = 1;//允许外部中断0
	  IT1 = 1;//设置为下降沿触发，避障模块的避障功能
}


unsigned char code hztest[][32]=    //二维数组，目的是减少运算，可以用最基本的一维数组，每个汉字有32个字节数据
{
	  /*--  ??:  ?  --*/
		/*--  ???12;  ??????????:?x?=16x16   --*/
		0x20,0x27,0xA4,0x64,0x24,0x27,0x20,0x04,0x04,0xFF,0x04,0x47,0x34,0x04,0x04,0x00,
		0x08,0xD2,0x41,0x7E,0x40,0xD0,0x09,0x06,0x38,0xC0,0x00,0xFC,0x02,0x02,0x0E,0x00,

		/*--  ??:  ?  --*/
		/*--  ???12;  ??????????:?x?=16x16   --*/
		0x00,0x1F,0x80,0x40,0x00,0x47,0x44,0x44,0x44,0x47,0x40,0x40,0x40,0x7F,0x00,0x00,
		0x00,0xFF,0x00,0x00,0x00,0xF8,0x10,0x10,0x10,0xF8,0x00,0x02,0x01,0xFE,0x00,0x00,

		/*--  ??:  ?  --*/
		/*--  ???12;  ??????????:?x?=16x16   --*/
		0x00,0x3F,0x00,0x00,0xFF,0x00,0x00,0x0F,0x08,0x08,0xFF,0x08,0x08,0x0F,0x00,0x00,
		0x00,0xE1,0x02,0x0C,0xF0,0x00,0x00,0xF8,0x00,0x00,0xFF,0x10,0x08,0xF0,0x00,0x00,

		/*--  ??:  ?  --*/
		/*--  ???12;  ??????????:?x?=16x16   --*/
		0x00,0x3F,0x20,0x20,0x3F,0x00,0x40,0x4F,0x41,0x41,0x41,0x7F,0x01,0x01,0x00,0x00,
		0x00,0xF0,0x20,0x20,0xF0,0x00,0x10,0x10,0x10,0x10,0x12,0x11,0x02,0xFC,0x00,0x00,



};


sbit KEY1 = P0^6;
sbit KEY2 = P0^7;

void main()
{
	  unsigned char buf[30];
	  int len = 0;
	
	  Iner0_Init();
	  Iner1_Init();
	  uart_init();
	  
	
    while(1)
		{
				P0 = 0x00;
		    P1 = 0x00;
			  P2 = 0x00;
			  P3 = 0x00;
			  delay_ms(300);
			  P0 = 0xff;
		    P1 = 0xff;
			  P2 = 0xff;
			  P3 = 0xff;
			  delay_ms(300);
		}
		

}


void Inter0_Isr() interrupt 0
{
	  EX0 = 0;
	
	  if(P2 == 0x00)
		{
			  P2 = 0xff;
		}
		else
		{
			  P2 = 0x00;
		}
	
	  EX0 = 1;
	
}

void Inter1_Isr() interrupt 2
{
	  EX1 = 0;
	
	  if(P2 == 0x00)
		{
			  P2 = 0xff;
		}
		else
		{
			  P2 = 0x00;
		}
	
	  EX1 = 1;
	
}

